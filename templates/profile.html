<!DOCTYPE html>

{% load staticfiles %}
{% load i18n %}

<html>
<head>
	<title>Atlas</title>
	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" type="text/css" rel="stylesheet"/>
	<link rel="stylesheet" type="text/css" href="{% static 'profile.css' %}"/>

	<link href='http://fonts.googleapis.com/css?family=Lato:400,900' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<script type="text/javascript"
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0H2gmjFao_osUOe6ZXJqZDTUO6iOuwEQ&sensor=true">
	</script>
	<script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/src/infobox.js"></script>
	<script type="text/javascript">
	function initialize() {
		var styles = [
		{
			featureType: "administrative.country",
			stylers: [
			{ visibility: "on" }
			]
		},{
			featureType: "administrative.province",
			stylers: [
			{ visibility: "on" }
			]
		},{
			featureType: "landscape",
			stylers: [
			{ visibility: "off" }
			]
		},{
			featureType: "poi",
			stylers: [
			{ visibility: "off" }
			]
		},{
			featureType: "road",
			stylers: [
			{ visibility: "off" }
			]
		}
		]
		var mapOptions = {
			zoom: 2,
			center: new google.maps.LatLng(25, 0),
			mapTypeControl: false,
			streetViewControl: false,
			minZoom: 2,
			maxZoom: 6,
			panControlOptions: {
				position: google.maps.ControlPosition.LEFT_CENTER
			},
			zoomControlOptions: {
				position: google.maps.ControlPosition.LEFT_CENTER
			},
			styles: styles
		};
		var map = new google.maps.Map(document.getElementById("map-canvas"),
			mapOptions);


		// DATA LAYERS STUFF
		// ========================================================================
		//
		//
		//

		map.data.loadGeoJson('{% static "countries-hires.json" %}');

		var infowindow;
		var been = new Array();
		var lived = new Array();

		map.data.setStyle(function(feature) {
			var color = 'white';
			var opacity = 0;
			if (feature.getProperty('been')) {
				color = '#003399';
				opacity = 0.5;
			} else if (feature.getProperty('lived')) {
				color = '#008C00';
				opacity = 0.5;
			}
			return ({
				fillColor: color,
				fillOpacity: opacity,
				strokeWeight: 1
			});
		});

		map.data.addListener('click', function(event) {
			var countryName = event.feature.getProperty('NAME');
			if (!event.feature.getProperty('been') && !event.feature.getProperty('lived')) {
				event.feature.setProperty('been', true);
				been.push(countryName);
			}
			console.log("been: " + been);
			console.log("lived: " + lived);
			if (typeof infowindow !== 'undefined') {
				infowindow.close();
			}
			var contentString =
				'<div id="content">'+
				'<h3 class="firstHeading">'+countryName+'</h3>'+
				'<div id="bodyContent">'+
				"<label class='choice' for='live'>"+
				"<input id='live' type='radio' name='choice' value='#008C00' />"+
				"<a class='Live'>◼ I've lived here.</a>"+
				"</label><br>"+
				"<label class='choice' for='been'>"+
				"<input id='been' type='radio' name='choice' value='#003399' />"+
				"<a class='Been'>◼ I've been here.</a>"+
				"</label><br>"+
				"<label class='choice' for='cancel'>"+
				"<input id='cancel' type='radio' name='choice' value='#FFFFFF' />"+
				"<a class='Cancel'>◻ Cancel</a>"+
				"</label>"+
				'</div>'+
				"</div>";
			infowindow = new google.maps.InfoWindow({
				content: contentString,
				position: new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
			});
			map.panTo(infowindow.getPosition());
			if (map.getZoom() < 4) {
				map.setZoom(4);
			}
			infowindow.open(map);

			google.maps.event.addListener(infowindow, 'domready', function() {
				document.getElementById('been').addEventListener('click', function(e) {
					var indlive = lived.indexOf(countryName);
					if (indlive > -1) {
						lived.splice(indlive, 1);
					}
					if (been.indexOf(countryName) === -1) {
						been.push(countryName);
					}
					event.feature.setProperty('lived', false);
					event.feature.setProperty('been', true);
					console.log("been: " + been);
					console.log("lived: " + lived);
				});
				document.getElementById('live').addEventListener('click', function(e) {
					var indbeen = been.indexOf(countryName);
					if (indbeen > -1) {
						been.splice(indbeen, 1);
					}
					if (lived.indexOf(countryName) === -1) {
						lived.push(countryName);
					}
					event.feature.setProperty('been', false);
					event.feature.setProperty('lived', true);
					console.log("been: " + been);
					console.log("lived: " + lived);
				});
				document.getElementById('cancel').addEventListener('click', function(e) {
					var indlive = lived.indexOf(countryName);
					var indbeen = been.indexOf(countryName);
					if (indlive > -1) {
						lived.splice(indlive, 1);
					}
					if (indbeen > -1) {
						been.splice(indbeen, 1);
					}
					event.feature.setProperty('been', false);
					event.feature.setProperty('lived', false);
					console.log("been: " + been);
					console.log("lived: " + lived);
				});
			});
		});

		map.data.addListener('mouseover', function(event) {
			map.data.revertStyle();
			map.data.overrideStyle(event.feature, {strokeWeight: 2.5});
		});

		map.data.addListener('mouseout', function(event) {
			map.data.revertStyle();
		});

		var input = document.getElementById('search');
		var options = {
			types: ['(regions)']
		};
		map.controls[google.maps.ControlPosition.RIGHT_CENTER].push(input);
		// var searchBox = new google.maps.places.SearchBox(
		// 	/** @type {HTMLInputElement} */(input));
	}
	
	google.maps.event.addDomListener(window, 'load', initialize);

</script>
</head>
<body>

	<div class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">

			<a class="navbar-brand" href="{% url 'home' %}">Atlas</a>

			{% if user.is_authenticated %}
			<p class="navbar-text navbar-right">Hello there, <a href="{% url 'profile' %}" class="navbar-link">{{ user.username }}</a>!&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; <a href="{% url 'auth_logout' %}" class="navbar-link">Log out</a></p>
			{% endif %}

		</div>
	</div>

	<!-- <div class="spinner">
		<div class="rect1"></div>
		<div class="rect2"></div>
		<div class="rect3"></div>
		<div class="rect4"></div>
		<div class="rect5"></div>
	</div> -->

	<input id="search" class="controls" type="text" placeholder="Search for a place">

	<div id="map-canvas"/>
</body>
</html>